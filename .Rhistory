cor(dat)
?pchi
?pchisq
pchisq(10,2)
pchisq(3,2)
pchisq(3,1)
log(-1.5)
?memory.limit
20*1024
library(sim1000G)
?readVCF
a.list<-list()
a<-read.table('/Users/zikunyang/Documents/Meeting_Dr.Tosto/Bench_mark_paper/Code/Tractor/chr_1_peru_plink2_clean_mac.anc0.dosage.txt',
header=T)
head(a[,1:10])
b<-colSums(a[,-c(1:5)])
b<-colSums(t(a[,-c(1:5)]))
maf<-b/(2*109)
table(maf)
a<-read.table('/Users/zikunyang/Documents/Meeting_Dr.Tosto/Bench_mark_paper/Code/Tractor/chr_1_peru_plink2_clean_mac.anc0.hapcount.txt',
header=T)
head(a[,1:10])
#########Phenotype generation#############
library(mvtnorm)
pca.file<-read.table('/Users/zikunyang/Documents/Meeting_Dr.Tosto/Bench_mark_paper/data/Hapnest/chr20/hapnest_20_prune_chunk_two_way_1.eigenvec')
tau=1
n=nrow(pca.file)
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
b<-t(b)
cc.ratio<-1/30#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
b=rnorm(n)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=fam$V2,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca$loadings[,1],
PC2=pca$loadings[,2],
PC3=pca$loadings[,3])
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca$loadings[,1],
PC2=pca$loadings[,2],
PC3=pca$loadings[,3])
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
sum(binary.outcome)
round(n*0.0075)
n*0.0075
cc.ratio<-1/50#1/10
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/50#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
write.table(tractor.phe,paste0('/Volumes/My_Passport/GWAS_research/Simulation_paper/data/hapnest/phenotype/tractor_phe_extreme_imbalanced_',s,'.txt'),
quote = F,row.names = F,col.names = T,sep = '\t')
sum(binary.outcome)
sum(binary.outcome)>round(n*0.0075)
sum(binary.outcome)<round(n*0.0125)
round(n*0.0125)
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/100#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(sum(binary.outcome))
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/200#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/200#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/300#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/400#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
#beta=as.matrix(rep(log(alpha),ncol(geno)))
#beta=as.matrix(rnorm(ncol(geno),0,0.01^2))
s=1
while(s<101){
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/400#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
if(sum(binary.outcome)>round(n*0.0075)&sum(binary.outcome)<round(n*0.0125)){
print(s)
print(sum(binary.outcome))
write.table(tractor.phe,paste0('/Volumes/My_Passport/GWAS_research/Simulation_paper/data/hapnest/phenotype/tractor_phe_extreme_imbalanced_',s,'.txt'),
quote = F,row.names = F,col.names = T,sep = '\t')
s=s+1
}
}
round(n*0.125)
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/30#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
round(n*0.075)
#beta=as.matrix(rep(log(alpha),ncol(geno)))
#beta=as.matrix(rnorm(ncol(geno),0,0.01^2))
s=1
while(s<101){
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/30#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
if(sum(binary.outcome)>round(n*0.085)&sum(binary.outcome)<round(n*0.115)){
print(s)
print(sum(binary.outcome))
write.table(tractor.phe,paste0('/Volumes/My_Passport/GWAS_research/Simulation_paper/data/hapnest/phenotype/tractor_phe_imbalanced_',s,'.txt'),
quote = F,row.names = F,col.names = T,sep = '\t')
s=s+1
}
}
round(n*0.515)
round(n*0.485)
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/10#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/5#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/2#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
o),0,0.01^2))
#beta=as.matrix(rep(log(alpha),ncol(geno)))
#beta=as.matrix(rnorm(ncol(geno),0,0.01^2))
s=1
while(s<101){
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/2#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
if(sum(binary.outcome)>round(n*0.485)&sum(binary.outcome)<round(n*0.515)){
print(s)
print(sum(binary.outcome))
write.table(tractor.phe,paste0('/Volumes/My_Passport/GWAS_research/Simulation_paper/data/hapnest/phenotype/tractor_phe_balanced_',s,'.txt'),
quote = F,row.names = F,col.names = T,sep = '\t')
s=s+1
}
}
print(sum(binary.outcome))
round(n*0.485)
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/1.5#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(sum(binary.outcome))
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/1.5#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(sum(binary.outcome))
sum(binary.outcome)<round(n*0.515)
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/1.6#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
print(s)
print(sum(binary.outcome))
#beta=as.matrix(rep(log(alpha),ncol(geno)))
#beta=as.matrix(rnorm(ncol(geno),0,0.01^2))
s=1
while(s<101){
X=matrix(c(rnorm(n,0,1),rbinom(n,1,0.5)),ncol=2,nrow=n)
b=rnorm(n)
cc.ratio<-1/1.6#1/10
a0=log(cc.ratio)
mu=as.matrix(rep(a0,n))+b+X%*%as.matrix(rep(1,2))#+as.matrix(geno)%*%beta
binary.outcome<-rbinom(n,1,exp(mu)/(1+exp(mu)))
tractor.phe<-data.frame(IID=pca.file$V1,
y=binary.outcome,
AGE=X[,1],
SEX=X[,2],
PC1=pca.file[,2],
PC2=pca.file[,3],
PC3=pca.file[,4])
if(sum(binary.outcome)>round(n*0.485)&sum(binary.outcome)<round(n*0.515)){
print(s)
print(sum(binary.outcome))
write.table(tractor.phe,paste0('/Volumes/My_Passport/GWAS_research/Simulation_paper/data/hapnest/phenotype/tractor_phe_balanced_',s,'.txt'),
quote = F,row.names = F,col.names = T,sep = '\t')
s=s+1
}
}
a<-diag(20)
class(a)
rf.two<-read.table('/Users/zikunyang/Documents/Meeting_Dr.Tosto/Bench_mark_paper/data/Hapnest/chr20/hapnest_two_cohorts_prune_chr20_1.rfmix.Q')
rf.two<-read.table('hapnest_two_cohorts_prune_chr20_EAS_EUR_1.rfmix.Q')
rf.two<-read.table('/Users/zikunyang/Documents/Meeting_Dr.Tosto/Bench_mark_paper/data/Hapnest/chr20/hapnest_two_cohorts_prune_chr20_EAS_EUR_1.rfmix.Q')
head(rf.two)
sum(rf.two>0.2)
sum(rf.two$V2>0.2)
sum(rf.two$V2>0.3)
sum(rf.two$V2>0.4)
rf.two<-read.table('/Users/zikunyang/Documents/Meeting_Dr.Tosto/Bench_mark_paper/data/Hapnest/chr20/hapnest_two_cohorts_prune_chr20_EAS_EUR_2.rfmix.Q')
sum(rf.two$V2>0.4)
sum(rf.two$V2>0.3)
#install.packages("devtools")
#devtools::install_github("klutometis/roxygen")
rm(list=ls())
# install.packages('Rcpp')
#install.packages('RcppArmadillo')
#install.packages('RcppGSL')
#install.packages('roxygen2')
#install.packages('glmnet')
library("devtools")
library(roxygen2)
library(Rcpp)
#install.packages("pkgKitten")
library(RcppArmadillo)
library(glmnet)
library(tools)
library(RcppGSL)
library(Matrix)
setwd('/Users/zikunyang/Documents/GitHub/CARMA')
document()
warnings()
build()
install.packages('/Users/zikunyang/Documents/GitHub/CARMA_1.0.tar.gz', repos = NULL, type="source")
set.seed(1000)
library(dplyr)
library(data.table)
library(CARMA)
setwd('/Users/zikunyang/Documents/Meeting_Prof.Iuliana/Fine-mapping/Coding/KK_lab')
sumstat=fread(file = "CARMA_loci_43",
sep = "\t", header = T, check.names = F, data.table = F,
stringsAsFactors = F)
annot=fread(file = "anno_loci_43",
sep = "\t", header = T, check.names = F, data.table = F,
stringsAsFactors = F)
LD=fread(file = "CARMA_LD_result_43.ld",
sep = "\t", header = F, check.names = F, data.table = F,
stringsAsFactors = F)
head(b)
plot(as.matrix(LD)[80,])
sumstat$Z[which(LD[80,]==1)]
z.list<-list()
ld.list<-list()
annot.list<-list()
lambda.list<-list()
z.list[[1]]<-sumstat$Z
ld.list[[1]]<-as.matrix(LD)
lambda.list[[1]]<-1
annot.list[[1]]<-as.matrix(cbind(1, annot %>% select(-(ID:SNP))))
###Error in B.list[[1]][-all.c.index] : only 0's may be mixed with negative subscripts
CARMA_fixed_sigma(z.list,ld.list,lambda.list=lambda.list,w.list=annot.list,
outlier.switch=T,BF.index = 1/10)
cc<-readRDS('/Users/zikunyang/Documents/Meeting_Prof.Iuliana/Fine-mapping/Coding/KK_lab/post__poi_C.RData')
l<-cc[[1]][[1]]
l
l<-cc[[1]][[1]][[1]]
m<-cc[[1]][[1]][[2]]
credible.model.fun<-function(likelihood,model.space,bayes.threshold=10){
na.index<-which(is.na(likelihood))
if(length(na.index)!=0){
likelihood<-likelihood[-na.index]
model.space<-model.space[-na.index,]
}
post.like.temp<-likelihood-likelihood[1]
post.prob<-exp(post.like.temp)/(sum(exp(post.like.temp)))
bayes.f<-post.prob[1]/post.prob
candidate.model<-1
credible.model.list<-list()
credible.model.list[[1]]<-list()
input.rs<-c()
for(ss in 1:length(which(bayes.f<bayes.threshold))){
credible.model.list[[1]][[ss]]<-which(model.space[ss,]==1)
input.rs<-c(input.rs,which(model.space[ss,]==1))
}
credible.model.list[[2]]<-data.frame(Posterior.Prob=post.prob[which(bayes.f<bayes.threshold)])
credible.model.list[[3]]<-unique(input.rs)
return(credible.model.list )
}
credible.model.fun(l,model.space = m)
credible.model.fun<-function(likelihood,model.space,bayes.threshold=10){
na.index<-which(is.na(likelihood))
if(length(na.index)!=0){
likelihood<-likelihood[-na.index]
model.space<-model.space[-na.index,]
}
post.like.temp<-likelihood-likelihood[1]
post.prob<-exp(post.like.temp)/(sum(exp(post.like.temp)))
bayes.f<-post.prob[1]/post.prob
candidate.model<-1
credible.model.list<-list()
credible.model.list[[1]]<-list()
input.rs<-c()
for(ss in 1:length(which(bayes.f<bayes.threshold))){
credible.model.list[[1]][[ss]]<-which(model.space[ss,]==1)
input.rs<-c(input.rs,which(model.space[ss,]==1))
}
credible.model.list[[2]]<-data.frame(Posterior.Prob=post.prob[which(bayes.f<bayes.threshold)])
credible.model.list[[3]]<-unique(input.rs)
return(credible.model.list )
}
credible.model.fun(l,model.space = m)
credible.model.fun(l,model.space = m,bayes.threshold = NULL)
credible.model.fun(l,model.space = m,bayes.threshold = 1)
credible.model.fun(l,model.space = m,bayes.threshold = 10)
credible.model.fun(l,model.space = m,bayes.threshold = 20)
###Error in B.list[[1]][-all.c.index] : only 0's may be mixed with negative subscripts
CARMA_fixed_sigma(z.list,ld.list,lambda.list=lambda.list,w.list=annot.list,
outlier.switch=T,outlier.BF.index = 1/10)
b<-readRDS('/Users/zikunyang/Documents/Meeting_Prof.Iuliana/Fine-mapping/Coding/KK_lab/post_locus_1_outliers.RData')
setwd('/Users/zikunyang/Documents/GitHub/CARMA')
document()
warnings()
build()
z<-sumstat$Z
ld<-as.matrix(LD)
impute.z<-rep(NA,nrow(ld))
pre<-ld[i,]*z
i=1
pre<-ld[i,]*z
head(sumstat)
for(i in 1:nrow(ld)){
pre<-ld[i,]*z
impute.z[i]<-pre[which.max(abs(pre))]
}
plot(impute.z)
points(z,col=2)
z.list<-list()
ld.list<-list()
annot.list<-list()
lambda.list<-list()
z.list[[1]]<-impute.z
ld.list[[1]]<-as.matrix(LD)
lambda.list[[1]]<-1
annot.list[[1]]<-as.matrix(cbind(1, annot %>% select(-(ID:SNP))))
